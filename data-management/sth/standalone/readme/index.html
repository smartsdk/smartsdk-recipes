<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../../../img/favicon.ico">
  <title>Standalone - SmartSDK Recipes</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../../../css/highlight.css">
  <link href="https://fiware.org/style/fiware_readthedocs.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Standalone";
    var mkdocs_page_input_path = "data-management/sth/standalone/readme.md";
    var mkdocs_page_url = "/data-management/sth/standalone/readme/";
  </script>
  
  <script src="../../../../js/jquery-2.1.1.min.js"></script>
  <script src="../../../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../../.." class="icon icon-home"> SmartSDK Recipes</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Recipes</span></li>

        
            
    <ul class="subnav">
    <li><span>Data/Context Management</span></li>

        
            
    <ul class="subnav">
    <li><span>Context Broker</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../context-broker/readme/">Intro</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../context-broker/simple/readme/">Simple</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../context-broker/ha/readme/">HA</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>STH</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../readme/">Intro</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Standalone</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#standalone">Standalone</a></li>
                
                    <li><a class="toctree-l4" href="#introduction">Introduction</a></li>
                
                    <li><a class="toctree-l4" href="#a-walkthrough">A walkthrough</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ha/readme/">HA</a>
        
    </li>

        
    </ul>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>IoT Services Enablement</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../../iot-services/readme/">IoT Broker</a>
        
    </li>

        
    </ul>

        
            
    <ul class="subnav">
    <li><span>Utils</span></li>

        
            
    <ul class="subnav">
    <li><span>Mongodb</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../../utils/mongodb/replica/readme/">Replica Set</a>
        
    </li>

        
    </ul>

        
    </ul>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../../../tools/readme/">Tools</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../..">SmartSDK Recipes</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../..">Docs</a> &raquo;</li>
    
      
        
          <li>Data/Context Management &raquo;</li>
        
      
        
          <li>STH &raquo;</li>
        
      
    
    <li>Standalone</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/martel-innovate/smartsdk-recipes/edit/master/recipes/data-management/sth/standalone/readme.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="standalone">Standalone</h1>
<h3 id="introduction">Introduction</h3>
<p>The idea of this standalone walkthrough is to test and showcase the Comet Generic Enabler within a simple notification-based scenario, like the one illustrated below.</p>
<p><img src='http://g.gravizo.com/g?
digraph Cluster {
    label="Docker Swarm"
    rankdir=LR;
    compound=true;
    node [shape="record" style="filled" fillcolor=aliceblue];
    splines=line;
    "Client" [shape=oval];
    "Orion";
    "Orion DB" [shape=egg];
    "Comet LB";
    Comet1;
    Comet2;
    Comet3;
    "Comet DB" [shape=egg];
    "Orion" -> "Comet LB";
    "Orion" -&gt; "Comet LB";
    "Orion" -&gt; "Comet LB" [label="NGSI Notifications"];
    "Orion DB" -&gt; "Orion"[dir=both];
    "Client" -&gt; "Orion" [label=1026];
    "Client" -&gt; "Comet LB" [label=8666];
    "Comet LB" -&gt; {Comet1,Comet2,Comet3};
    "Comet2" -&gt; "Comet DB";
    "Comet1" -&gt; "Comet DB";
    "Comet3" -&gt; "Comet DB";
    {rank=same; "Orion"; "Orion DB";}
}
'&gt;</p>
<h3 id="a-walkthrough">A walkthrough</h3>
<p>Firstly, you need to have a Docker Swarm (docker &gt;= 1.13) already setup. If you don't have one, checkout the <a href="../../../../tools/readme/">tools</a> section for a quick way to setup a local swarm.</p>
<pre><code>miniswarm start 3
eval $(docker-machine env ms-manager0)
</code></pre>
<p>To start the whole stack simply run, as usual:</p>
<pre><code>docker stack deploy -c docker-compose.yml comet
</code></pre>
<p>Then, wait until you see all the replicas up and running:</p>
<pre><code>docker service ls
ID            NAME               MODE        REPLICAS  IMAGE
1ysxmrxrqvp4  comet_comet-mongo  replicated  1/1       mongo:3.2
8s9acybjxo0m  comet_orion        replicated  1/1       fiware/orion:latest
ra84eex0zsd0  comet_comet        replicated  3/3       telefonicaiot/fiware-sth-comet:latest
xg8ds3szkoi7  comet_orion-mongo  replicated  1/1       mongo:3.2
</code></pre>
<p>Now let's start some checkups. For convenience, let's save the IP address of the Orion and Comet services. In this scenario, since both are deployed on Swarm exposing their services ports, only one entry-point to the Swarm's ingress network will suffice.</p>
<pre><code>ORION=http://$(docker-machine ip ms-manager0)
COMET=http://$(docker-machine ip ms-manager0)
</code></pre>
<p>Let's start some checkups, first making sure Orion is up and running.</p>
<pre><code>sh ../../context-broker/query.sh $ORION
{
"orion" : {
  "version" : "1.7.0-next",
  "uptime" : "0 d, 0 h, 1 m, 39 s",
  "git_hash" : "f710ee525f0fa55f665e578e309fc716c12cfd99",
  "compile_time" : "Wed Feb 22 10:14:18 UTC 2017",
  "compiled_by" : "root",
  "compiled_in" : "b99744612d0b"
}
}
[]
</code></pre>
<p>Let's insert some simple data (Room1 measurements):</p>
<pre><code>sh ../../context-broker/insert.sh $ORION
</code></pre>
<p>Now, let's subscribe Comet to the notifications of changes in temperature of Room1.</p>
<pre><code>sh ../subscribe.sh $COMET
{
  "subscribeResponse" : {
    "subscriptionId" : "58b98c0cdb69948641065907",
    "duration" : "PT24H"
  }
}
</code></pre>
<p>Let's update the temperature value in Orion...</p>
<pre><code>sh ../../context-broker/update.sh $ORION
</code></pre>
<p>And check you can see the Short-Term-Historical view of both measurements.</p>
<pre><code>sh ../query_sth.sh $COMET
{
    "contextResponses": [
        {
            "contextElement": {
                "attributes": [
                    {
                        "name": "temperature",
                        "values": [
                            {
                                "attrType": "Float",
                                "attrValue": 23,
                                "recvTime": "2017-03-03T15:30:20.650Z"
                            },
                            {
                                "attrType": "Float",
                                "attrValue": 29.3,
                                "recvTime": "2017-03-03T15:32:48.741Z"
                            }
                        ]
                    }
                ],
                "id": "Room1",
                "isPattern": false,
                "type": "Room"
            },
            "statusCode": {
                "code": "200",
                "reasonPhrase": "OK"
            }
        }
    ]
}
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../ha/readme/" class="btn btn-neutral float-right" title="HA">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../readme/" class="btn btn-neutral" title="Intro"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/martel-innovate/smartsdk-recipes" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../../readme/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../ha/readme/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../../../js/theme.js"></script>

</body>
</html>
